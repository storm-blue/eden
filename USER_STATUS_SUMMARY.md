# ç”¨æˆ·çŠ¶æ€è‡ªåŠ¨åˆ·æ–° - åŠŸèƒ½æ€»ç»“

## ðŸŽ¯ åŠŸèƒ½æ¦‚è¿°

**âœ… å·²å®žçŽ°å®Œæˆï¼**

ç³»ç»Ÿæ¯30åˆ†é’Ÿè‡ªåŠ¨ä¸ºæ‰€æœ‰ç”¨æˆ·ä»Žå…¶ä¸“å±žçŠ¶æ€åˆ—è¡¨ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªæ–°çŠ¶æ€ã€‚

## ðŸ‘¥ å·²é…ç½®çš„ç”¨æˆ·

| ç”¨æˆ· | çŠ¶æ€æ•°é‡ | çŠ¶æ€é£Žæ ¼ |
|-----|---------|---------|
| ðŸ‘‘ **æŽæ˜Ÿæ–—** | 8ä¸ª | é¢†å¯¼è€…é£Žæ ¼ï¼ˆå¤„ç†æ”¿åŠ¡ã€æ‰¹é˜…æ–‡ä»¶ã€è§†å¯ŸåŸŽå¸‚...ï¼‰ |
| ðŸ’• **ç§¦å°æ·®** | 8ä¸ª | æ–‡è‰ºé£Žæ ¼ï¼ˆç”»ç”»ã€é˜…è¯»ã€ä¹¦æ³•ã€å“èŒ¶...ï¼‰ |
| ðŸ›¡ï¸ **å­˜å­** | 8ä¸ª | å®ˆæŠ¤è€…é£Žæ ¼ï¼ˆå®ˆæŠ¤ã€å·¡é€»ã€è­¦æˆ’ã€è®­ç»ƒ...ï¼‰ |
| ðŸ•Šï¸ **å°ç™½é¸½** | 8ä¸ª | è‡ªç”±é£Žæ ¼ï¼ˆç¿±ç¿”ã€é€ä¿¡ã€è§…é£Ÿã€é£žè¡Œ...ï¼‰ |
| ðŸ“– **é‚“ç‚Žåšå‡** | 8ä¸ª | å­¦è€…é£Žæ ¼ï¼ˆç ”ç©¶ã€æ€è€ƒã€å†™ä½œã€äº¤æµ...ï¼‰ |
| ðŸŒŸ **å…¶ä»–ç”¨æˆ·** | 8ä¸ª | é»˜è®¤é€šç”¨çŠ¶æ€ï¼ˆå¿™ç¢Œã€ä¼‘æ¯ã€å·¥ä½œ...ï¼‰ |

## â° è¿è¡Œæœºåˆ¶

### è‡ªåŠ¨æ‰§è¡Œ
- **æ—¶é—´**ï¼šæ¯30åˆ†é’Ÿï¼ˆæ¯å°æ—¶çš„0åˆ†å’Œ30åˆ†ï¼‰
- **èŒƒå›´**ï¼šæ‰€æœ‰ç”¨æˆ·
- **æ–¹å¼**ï¼šä»Žå„è‡ªçš„çŠ¶æ€åˆ—è¡¨ä¸­éšæœºé€‰æ‹©

### çŠ¶æ€ç¤ºä¾‹

**æŽæ˜Ÿæ–—å¯èƒ½çš„çŠ¶æ€å˜åŒ–**ï¼š
```
12:00 â†’ å¤„ç†æ”¿åŠ¡ðŸ‘‘
12:30 â†’ äº«ç”¨ä¸‹åˆèŒ¶â˜•
13:00 â†’ æ‰¹é˜…æ–‡ä»¶ðŸ“œ
13:30 â†’ ä¸Žç§¦å°æ·®è°ˆå¿ƒðŸ’•
```

**ç§¦å°æ·®å¯èƒ½çš„çŠ¶æ€å˜åŒ–**ï¼š
```
12:00 â†’ åœ¨å…¬å›­ç”»ç”»ðŸŽ¨
12:30 â†’ é˜…è¯»ä¹¦ç±ðŸ“š
13:00 â†’ é™ªä¼´æŽæ˜Ÿæ–—ðŸ’•
13:30 â†’ å“èŒ¶ä¸­ðŸµ
```

## ðŸ§ª æµ‹è¯•æ–¹æ³•

### æ–¹æ³•1ï¼šå¿«é€Ÿæµ‹è¯•ï¼ˆæŽ¨èï¼‰

```bash
cd /Users/g01d-01-0924/eden
./trigger-status-refresh.sh
```

è¿™ä¼šï¼š
1. âœ… æ˜¾ç¤ºå½“å‰æ‰€æœ‰ç”¨æˆ·çš„çŠ¶æ€
2. ðŸ”„ æ‰‹åŠ¨è§¦å‘ä¸€æ¬¡åˆ·æ–°
3. âœ… æ˜¾ç¤ºåˆ·æ–°åŽçš„çŠ¶æ€ï¼ˆå¯ä»¥çœ‹åˆ°å˜åŒ–ï¼‰

### æ–¹æ³•2ï¼šç­‰å¾…è‡ªåŠ¨æ‰§è¡Œ

ä¸‹æ¬¡è‡ªåŠ¨æ‰§è¡Œæ—¶é—´ï¼š
- å¦‚æžœçŽ°åœ¨æ˜¯ 12:15ï¼Œä¸‹æ¬¡æ‰§è¡Œæ˜¯ 12:30
- å¦‚æžœçŽ°åœ¨æ˜¯ 12:45ï¼Œä¸‹æ¬¡æ‰§è¡Œæ˜¯ 13:00

æŸ¥çœ‹æ—¥å¿—ï¼š
```bash
tail -f eden-server/logs/*.log | grep "ç”¨æˆ·çŠ¶æ€åˆ·æ–°"
```

### æ–¹æ³•3ï¼šä½¿ç”¨APIæµ‹è¯•

```bash
# 1. ç™»å½•
TOKEN=$(curl -s -X POST "http://localhost:8080/api/admin/login" \
    -H "Content-Type: application/json" \
    -d '{"username":"admin","password":"admin123"}' | jq -r '.data.token')

# 2. è§¦å‘åˆ·æ–°
curl -X POST "http://localhost:8080/api/admin/trigger-status-refresh" \
    -H "Authorization: Bearer $TOKEN" | jq .

# 3. æŸ¥çœ‹ç»“æžœ
curl -s "http://localhost:8080/api/admin/users" | \
    jq -r '.data[] | "\(.userId): \(.status)"'
```

## âž• æ·»åŠ æ–°ç”¨æˆ·çŠ¶æ€

### æ­¥éª¤

1. æ‰“å¼€æ–‡ä»¶ï¼š`eden-server/src/main/java/com/eden/lottery/service/UserStatusService.java`

2. åœ¨ `static {}` å—ä¸­æ·»åŠ ï¼š

```java
// æ–°ç”¨æˆ·çš„çŠ¶æ€åˆ—è¡¨
USER_STATUS_MAP.put("æ–°ç”¨æˆ·å", new String[]{
    "çŠ¶æ€1ðŸŒŸ",
    "çŠ¶æ€2ðŸ’«",
    "çŠ¶æ€3âœ¨",
    "çŠ¶æ€4ðŸŽ¯",
    "çŠ¶æ€5ðŸ’¡",
    "çŠ¶æ€6ðŸŽ¨",
    "çŠ¶æ€7ðŸ“š",
    "çŠ¶æ€8ðŸŽµ"
});
```

3. é‡å¯æœåŠ¡ï¼š
```bash
cd eden-server
./start.sh  # æˆ– start.bat
```

## ðŸ“Š å½“å‰çŠ¶æ€åˆ—è¡¨è¯¦æƒ…

### æŽæ˜Ÿæ–—çš„8ä¸ªçŠ¶æ€
```
1. å¤„ç†æ”¿åŠ¡ðŸ‘‘
2. æ‰¹é˜…æ–‡ä»¶ðŸ“œ
3. è§†å¯Ÿæ˜Ÿæ˜ŸåŸŽðŸ›ï¸
4. æ€è€ƒåŸŽå¸‚å‘å±•ðŸ’­
5. äº«ç”¨ä¸‹åˆèŒ¶â˜•
6. åœ¨åŸŽå ¡ä¼‘æ¯ðŸ’¤
7. ä¸Žç§¦å°æ·®è°ˆå¿ƒðŸ’•
8. è§„åˆ’æœªæ¥âœ¨
```

### ç§¦å°æ·®çš„8ä¸ªçŠ¶æ€
```
1. é™ªä¼´æŽæ˜Ÿæ–—ðŸ’•
2. åœ¨å…¬å›­ç”»ç”»ðŸŽ¨
3. é˜…è¯»ä¹¦ç±ðŸ“š
4. æ¬£èµé£Žæ™¯ðŸ‘€
5. ç»ƒä¹ ä¹¦æ³•âœï¸
6. å¬éŸ³ä¹ä¸­ðŸŽµ
7. å“èŒ¶ä¸­ðŸµ
8. æ•£æ­¥ä¸­ðŸš¶
```

### å­˜å­çš„8ä¸ªçŠ¶æ€
```
1. å¿ è¯šå®ˆæŠ¤ä¸­ðŸ›¡ï¸
2. å·¡é€»æ˜Ÿæ˜ŸåŸŽðŸš¶
3. ä¿æŠ¤æŽæ˜Ÿæ–—ðŸ‘®
4. è­¦æˆ’ä¸­ðŸ‘ï¸
5. å€¼å‹¤ä¸­ðŸ’¼
6. è®­ç»ƒä¸­ðŸƒ
7. ä¼‘æ¯ç‰‡åˆ»ðŸ˜Œ
8. è§‚å¯Ÿå››å‘¨ðŸ”
```

### å°ç™½é¸½çš„8ä¸ªçŠ¶æ€
```
1. åœ¨å¤©ç©ºç¿±ç¿”ðŸ•Šï¸
2. é€ä¿¡ä¸­âœ‰ï¸
3. ä¼‘æ¯ä¸­ðŸ’¤
4. è§…é£Ÿä¸­ðŸŒ¾
5. æ¢³ç†ç¾½æ¯›âœ¨
6. æ¬£èµé£Žæ™¯ðŸŒ…
7. ä¸Žæœ‹å‹çŽ©è€ðŸŽˆ
8. é£žè¡Œè®­ç»ƒðŸª½
```

### é‚“ç‚Žåšå‡çš„8ä¸ªçŠ¶æ€
```
1. ç ”ç©¶å­¦é—®ðŸ“–
2. æ€è€ƒé—®é¢˜ðŸ¤”
3. å†™ä½œä¸­âœï¸
4. å–å’–å•¡â˜•
5. æ•£æ­¥æ€è€ƒðŸš¶
6. ä¸Žäººäº¤æµðŸ’¬
7. æ•´ç†ç¬”è®°ðŸ“
8. ä¼‘æ¯æ”¾æ¾ðŸ˜Œ
```

## ðŸ“š ç›¸å…³æ–‡æ¡£

| æ–‡æ¡£ | è¯´æ˜Ž |
|-----|------|
| **USER_STATUS_LIST.md** | è¯¦ç»†çš„çŠ¶æ€åˆ—è¡¨å’Œé…ç½®æŒ‡å— |
| **USER_STATUS_REFRESH_QUICK_START.md** | å¿«é€Ÿå¼€å§‹æŒ‡å— |
| **USER_STATUS_REFRESH.md** | å®Œæ•´çš„åŠŸèƒ½æ–‡æ¡£å’Œç¤ºä¾‹ |

## ðŸ”§ æ ¸å¿ƒä»£ç æ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜Ž |
|-----|------|
| `service/UserStatusService.java` | **çŠ¶æ€åˆ—è¡¨é…ç½®** |
| `task/UserStatusRefreshTask.java` | å®šæ—¶ä»»åŠ¡ |
| `controller/AdminController.java` | æ‰‹åŠ¨è§¦å‘æŽ¥å£ |
| `trigger-status-refresh.sh` | æµ‹è¯•è„šæœ¬ |

## ðŸŽ¨ è‡ªå®šä¹‰å»ºè®®

### 1. è°ƒæ•´çŠ¶æ€æ–‡æœ¬

å¯ä»¥ä¿®æ”¹çŽ°æœ‰çŠ¶æ€æ–‡æœ¬ï¼Œè®©å®ƒä»¬æ›´ç¬¦åˆè§’è‰²æ€§æ ¼ï¼š

```java
USER_STATUS_MAP.put("æŽæ˜Ÿæ–—", new String[]{
    "å¤„ç†ç´§æ€¥æ”¿åŠ¡ðŸ‘‘",  // æ”¹ä¸ºæ›´å…·ä½“çš„æè¿°
    "å¬å¼€é‡è¦ä¼šè®®ðŸ“‹",  // æ·»åŠ æ›´å¤šåœºæ™¯
    // ...
});
```

### 2. è°ƒæ•´åˆ·æ–°é¢‘çŽ‡

ä¿®æ”¹ `UserStatusRefreshTask.java`ï¼š

```java
// å½“å‰ï¼šæ¯30åˆ†é’Ÿ
@Scheduled(cron = "0 0,30 * * * ?")

// æ”¹ä¸ºæ¯15åˆ†é’Ÿ
@Scheduled(cron = "0 */15 * * * ?")

// æ”¹ä¸ºæ¯å°æ—¶
@Scheduled(cron = "0 0 * * * ?")
```

### 3. æ·»åŠ æ—¶é—´ç›¸å…³é€»è¾‘

å¯ä»¥åœ¨ `determineUserStatus()` æ–¹æ³•ä¸­æ·»åŠ æ—¶é—´åˆ¤æ–­ï¼š

```java
public String determineUserStatus(String userId, String residence) {
    LocalDateTime now = LocalDateTime.now();
    int hour = now.getHour();
    
    // å¤œé—´ç‰¹æ®ŠçŠ¶æ€
    if (hour >= 22 || hour < 6) {
        return "ç¡è§‰ä¸­ðŸ’¤";
    }
    
    // å¦åˆ™ä»Žåˆ—è¡¨ä¸­éšæœºé€‰æ‹©
    String[] statusList = USER_STATUS_MAP.getOrDefault(userId, USER_STATUS_MAP.get("default"));
    return statusList[random.nextInt(statusList.length)];
}
```

## âœ… éªŒè¯æ¸…å•

- [x] åˆ›å»º `UserStatusService.java` æœåŠ¡ç±»
- [x] åˆ›å»º `UserStatusRefreshTask.java` å®šæ—¶ä»»åŠ¡
- [x] ä¸º5ä¸ªç”¨æˆ·é…ç½®ä¸“å±žçŠ¶æ€åˆ—è¡¨
- [x] æ·»åŠ é»˜è®¤çŠ¶æ€åˆ—è¡¨
- [x] åœ¨ `AdminController` æ·»åŠ æ‰‹åŠ¨è§¦å‘æŽ¥å£
- [x] åˆ›å»ºæµ‹è¯•è„šæœ¬ `trigger-status-refresh.sh`
- [x] ç¼–å†™å®Œæ•´æ–‡æ¡£

## ðŸš€ ç«‹å³å¼€å§‹

1. **é‡å¯åŽç«¯æœåŠ¡**ï¼ˆå¦‚æžœè¿˜æ²¡é‡å¯ï¼‰
2. **è¿è¡Œæµ‹è¯•è„šæœ¬**ï¼š`./trigger-status-refresh.sh`
3. **è§‚å¯Ÿæ•ˆæžœ**ï¼šæ¯30åˆ†é’Ÿç”¨æˆ·çŠ¶æ€ä¼šè‡ªåŠ¨å˜åŒ–
4. **è‡ªå®šä¹‰**ï¼šä¿®æ”¹ `UserStatusService.java` æ·»åŠ æ›´å¤šç”¨æˆ·æˆ–çŠ¶æ€

---

**çŠ¶æ€è‡ªåŠ¨åˆ·æ–°ç³»ç»Ÿå·²å®Œå…¨å°±ç»ªï¼ðŸŽ‰**

