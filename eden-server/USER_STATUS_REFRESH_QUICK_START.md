# ç”¨æˆ·çŠ¶æ€è‡ªåŠ¨åˆ·æ–° - å¿«é€Ÿå¼€å§‹

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

ç³»ç»Ÿæ¯30åˆ†é’Ÿï¼ˆæ¯å°æ—¶çš„0åˆ†å’Œ30åˆ†ï¼‰è‡ªåŠ¨æ›´æ–°æ‰€æœ‰ç”¨æˆ·çš„çŠ¶æ€ã€‚

## ğŸ“ å®ç°çŠ¶æ€å†³å®šé€»è¾‘

### ç¼–è¾‘æ–‡ä»¶

æ‰“å¼€æ–‡ä»¶ï¼š`eden-server/src/main/java/com/eden/lottery/service/UserStatusService.java`

### ä¿®æ”¹æ–¹æ³•

æ‰¾åˆ° `determineUserStatus` æ–¹æ³•ï¼š

```java
public String determineUserStatus(String userId, String residence) {
    // åœ¨è¿™é‡Œå®ç°ä½ çš„é€»è¾‘
    
    // è¿”å›æ–°çŠ¶æ€ â†’ ç³»ç»Ÿä¼šæ›´æ–°åˆ°æ•°æ®åº“
    // è¿”å› null â†’ ä¸ä¿®æ”¹å½“å‰çŠ¶æ€
    return null;
}
```

### å‚æ•°è¯´æ˜

- `userId`: ç”¨æˆ·åï¼ˆä¾‹å¦‚ï¼šææ˜Ÿæ–—ã€ç§¦å°æ·®ã€å­˜å­ç­‰ï¼‰
- `residence`: å±…æ‰€ä»£ç ï¼ˆcastleã€parkã€city_hallã€palaceã€white_dove_houseï¼‰

### å½“å‰å®ç°

**âœ… å·²å®ç°ä¸ºæ¯ä¸ªç”¨æˆ·è®¾ç½®ä¸åŒçš„çŠ¶æ€åˆ—è¡¨ï¼Œéšæœºé€‰æ‹©**

æ¯ä¸ªç”¨æˆ·éƒ½æœ‰è‡ªå·±çš„ä¸“å±çŠ¶æ€åˆ—è¡¨ï¼ˆ8ä¸ªçŠ¶æ€ï¼‰ï¼Œç³»ç»Ÿä¼šæ¯30åˆ†é’Ÿä»åˆ—è¡¨ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªï¼š

| ç”¨æˆ· | çŠ¶æ€ç¤ºä¾‹ |
|-----|---------|
| ææ˜Ÿæ–— | å¤„ç†æ”¿åŠ¡ğŸ‘‘ã€æ‰¹é˜…æ–‡ä»¶ğŸ“œã€è§†å¯Ÿæ˜Ÿæ˜ŸåŸğŸ›ï¸ã€æ€è€ƒåŸå¸‚å‘å±•ğŸ’­... |
| ç§¦å°æ·® | é™ªä¼´ææ˜Ÿæ–—ğŸ’•ã€åœ¨å…¬å›­ç”»ç”»ğŸ¨ã€é˜…è¯»ä¹¦ç±ğŸ“šã€æ¬£èµé£æ™¯ğŸ‘€... |
| å­˜å­ | å¿ è¯šå®ˆæŠ¤ä¸­ğŸ›¡ï¸ã€å·¡é€»æ˜Ÿæ˜ŸåŸğŸš¶ã€ä¿æŠ¤ææ˜Ÿæ–—ğŸ‘®ã€è­¦æˆ’ä¸­ğŸ‘ï¸... |
| å°ç™½é¸½ | åœ¨å¤©ç©ºç¿±ç¿”ğŸ•Šï¸ã€é€ä¿¡ä¸­âœ‰ï¸ã€ä¼‘æ¯ä¸­ğŸ’¤ã€è§…é£Ÿä¸­ğŸŒ¾... |
| é‚“ç‚åšå‡ | ç ”ç©¶å­¦é—®ğŸ“–ã€æ€è€ƒé—®é¢˜ğŸ¤”ã€å†™ä½œä¸­âœï¸ã€å–å’–å•¡â˜•... |
| å…¶ä»–ç”¨æˆ· | ä½¿ç”¨é»˜è®¤çŠ¶æ€åˆ—è¡¨ï¼ˆå¿™ç¢Œä¸­ğŸ’«ã€ä¼‘æ¯ä¸­ğŸ˜Œã€å·¥ä½œä¸­ğŸ’¼...ï¼‰ |

### æ·»åŠ æ–°ç”¨æˆ·çš„çŠ¶æ€åˆ—è¡¨

åœ¨ `UserStatusService.java` çš„ `static {}` å—ä¸­æ·»åŠ ï¼š

```java
// æ–°ç”¨æˆ·çš„çŠ¶æ€åˆ—è¡¨
USER_STATUS_MAP.put("ç”¨æˆ·å", new String[]{
    "çŠ¶æ€1",
    "çŠ¶æ€2",
    "çŠ¶æ€3",
    // ... æ›´å¤šçŠ¶æ€
});
```

## ğŸ§ª æµ‹è¯•

### æ–¹æ³•1ï¼šè¿è¡Œæµ‹è¯•è„šæœ¬

```bash
# æ‰‹åŠ¨è§¦å‘å¹¶æŸ¥çœ‹å‰åå¯¹æ¯”
./trigger-status-refresh.sh
```

### æ–¹æ³•2ï¼šä½¿ç”¨APIç›´æ¥æµ‹è¯•

```bash
# 1. ç™»å½•
TOKEN=$(curl -s -X POST "http://localhost:8080/api/admin/login" \
    -H "Content-Type: application/json" \
    -d '{"username":"admin","password":"admin123"}' | jq -r '.data.token')

# 2. æ‰‹åŠ¨è§¦å‘åˆ·æ–°
curl -X POST "http://localhost:8080/api/admin/trigger-status-refresh" \
    -H "Authorization: Bearer $TOKEN" | jq .

# 3. æŸ¥çœ‹ç»“æœ
curl -s "http://localhost:8080/api/admin/users" | jq -r '.data[] | "\(.userId): \(.status)"'
```

### æ–¹æ³•3ï¼šç­‰å¾…è‡ªåŠ¨æ‰§è¡Œ

å®šæ—¶ä»»åŠ¡ä¼šåœ¨æ¯å°æ—¶çš„0åˆ†å’Œ30åˆ†è‡ªåŠ¨æ‰§è¡Œã€‚æŸ¥çœ‹æ—¥å¿—ï¼š

```bash
# å®æ—¶ç›‘æ§æ—¥å¿—
tail -f eden-server/logs/*.log | grep "ç”¨æˆ·çŠ¶æ€åˆ·æ–°"
```

## â° ä¿®æ”¹æ‰§è¡Œæ—¶é—´

ç¼–è¾‘æ–‡ä»¶ï¼š`eden-server/src/main/java/com/eden/lottery/task/UserStatusRefreshTask.java`

ä¿®æ”¹ `@Scheduled` æ³¨è§£ï¼š

```java
// å½“å‰ï¼šæ¯30åˆ†é’Ÿï¼ˆæ¯å°æ—¶çš„0åˆ†å’Œ30åˆ†ï¼‰
@Scheduled(cron = "0 0,30 * * * ?")

// æ”¹ä¸ºæ¯15åˆ†é’Ÿ
@Scheduled(cron = "0 */15 * * * ?")

// æ”¹ä¸ºæ¯å°æ—¶
@Scheduled(cron = "0 0 * * * ?")

// æ”¹ä¸ºæ¯10åˆ†é’Ÿ
@Scheduled(cron = "0 */10 * * * ?")
```

## ğŸ“š å®Œæ•´æ–‡æ¡£

è¯¦ç»†çš„å®ç°ç¤ºä¾‹å’Œè¯´æ˜ï¼Œè¯·æŸ¥çœ‹ï¼š
- `eden-server/USER_STATUS_REFRESH.md`

## ğŸ”§ ç›¸å…³æ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ |
|-----|------|
| `service/UserStatusService.java` | **çŠ¶æ€å†³å®šé€»è¾‘**ï¼ˆéœ€è¦ä½ å®ç°ï¼‰ |
| `task/UserStatusRefreshTask.java` | å®šæ—¶ä»»åŠ¡é…ç½® |
| `controller/AdminController.java` | æ‰‹åŠ¨è§¦å‘æ¥å£ |
| `trigger-status-refresh.sh` | æµ‹è¯•è„šæœ¬ |

