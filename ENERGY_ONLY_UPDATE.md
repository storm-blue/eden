# ⚡ 魔法系统更新：仅精力限制

## 🔄 更新说明

魔法系统已从**双重限制（精力+次数）**简化为**仅精力限制**。

### 之前的规则
- ❌ 每日次数限制（天降食物3次、改变天气3次、驱逐巨人1次）
- ✅ 精力消耗（天降食物5点、改变天气3点、驱逐巨人8点）

### 现在的规则
- ✅ **仅精力限制**：只要有足够精力就可以施展魔法
- ✅ 无次数限制：可以无限次施展（前提是有精力）

## 📊 新规则示例

### 魔法精力消耗
| 魔法 | 精力消耗 | 每日次数 |
|------|---------|---------|
| 天降食物 | **5点** ⚡⚡⚡⚡⚡ | ~~3次~~ **无限** |
| 改变天气 | **3点** ⚡⚡⚡ | ~~3次~~ **无限** |
| 驱逐巨人 | **8点** ⚡⚡⚡⚡⚡⚡⚡⚡ | ~~1次~~ **无限** |

**总精力：15点/天（凌晨12点恢复）**

### 新玩法示例

#### 示例1：专注食物
秦小淮今天只刷食物：

1. **早上**：施展"天降食物" → 精力：15 - 5 = 10点 ✅
2. **中午**：施展"天降食物" → 精力：10 - 5 = 5点 ✅
3. **下午**：施展"天降食物" → 精力：5 - 5 = 0点 ✅
4. **晚上**：无法施展（精力不足）❌

**结果**：一天可以施展3次"天降食物"，获得30000食物！

#### 示例2：灵活搭配
需要食物和应对巨人：

1. **早上**：施展"天降食物" → 15 - 5 = 10点 ✅
2. **中午**：巨人进攻！施展"驱逐巨人" → 10 - 8 = 2点 ✅
3. **下午**：无法施展"天降食物"（需要5点，只有2点）❌
4. **晚上**：等待第二天 ⏰

#### 示例3：频繁改天气
秦小淮今天只改天气：

1. 施展"改变天气" → 15 - 3 = 12点 ✅
2. 施展"改变天气" → 12 - 3 = 9点 ✅
3. 施展"改变天气" → 9 - 3 = 6点 ✅
4. 施展"改变天气" → 6 - 3 = 3点 ✅
5. 施展"改变天气" → 3 - 3 = 0点 ✅

**结果**：一天可以施展5次"改变天气"！

## 💡 策略建议

### 精力管理
1. **优先级排序**：
   - 驱逐巨人（8点）> 天降食物（5点）> 改变天气（3点）
   
2. **保留应急精力**：
   - 建议保留至少8点精力应对突发巨人进攻
   
3. **最大化利用**：
   - 每天可施展的组合更加灵活
   - 不再受次数限制束缚

### 常见组合

#### 平衡型（推荐）
- 天降食物(5) + 驱逐巨人(8) + 改变天气(3) = 16点 ❌ 超出1点
- 天降食物(5) + 天降食物(5) + 改变天气(3) = 13点 ✅

#### 食物型
- 天降食物 × 3 = 15点 ✅ 获得30000食物

#### 天气型
- 改变天气 × 5 = 15点 ✅ 改变5次天气

#### 应急型
- 驱逐巨人(8) + 天降食物(5) = 13点 ✅
- 驱逐巨人(8) + 改变天气(3) + 改变天气(3) = 14点 ✅

## 🎮 用户界面更新

### 魔法弹窗（新版）
```
┌─────────────────────────────────┐
│      ✨ 魔法管理                │
│  ┌───────────────────────────┐ │
│  │   ⚡ 当前精力              │ │
│  │      15 / 15              │ │
│  │ 每天凌晨12点恢复到满值      │ │
│  └───────────────────────────┘ │
│                                 │
│  ▼ 天降食物 ⚡5   [施展魔法]    │
│  ▼ 改变天气 ⚡3   [施展魔法]    │
│  ▼ 驱逐巨人 ⚡8   [施展魔法]    │
└─────────────────────────────────┘
```

### 变化点
- ✅ 移除次数显示 `(3/3)`
- ✅ 直接显示精力消耗 `⚡5`
- ✅ 精力不足时显示红色并禁用按钮
- ✅ 按钮文字：`施展魔法` 或 `精力不足`

## 🔧 技术实现

### 后端修改
1. ✅ `MagicService.castMagic()` - 移除次数检查和扣减
2. ✅ `MagicService` - 删除 `checkAndRefreshDailyUses()` 方法
3. ✅ `MagicService` - 删除 `refreshAllMagicDailyUses()` 方法
4. ✅ `DailyRefreshTask` - 移除魔法次数刷新逻辑

### 前端修改
5. ✅ `MagicModal.jsx` - 移除次数显示
6. ✅ `MagicModal.jsx` - 添加精力检查逻辑
7. ✅ `MagicModal.jsx` - 精力不足时禁用按钮

### 数据库
- **保留**：`magic` 表的 `daily_limit` 和 `remaining_uses` 字段（向后兼容）
- **使用**：仅 `energy_cost` 字段生效

## 🎯 游戏平衡

### 为什么移除次数限制？

1. **简化机制**：
   - 双重限制过于复杂
   - 玩家只需关注精力管理
   
2. **增加灵活性**：
   - 玩家可以根据需求自由选择
   - 不再被固定次数束缚
   
3. **策略深度**：
   - 精力管理本身就很有策略性
   - 需要在不同魔法间权衡

### 平衡性分析

**总精力15点的情况下：**
- 最多施展3次"天降食物"（15÷5=3）
- 最多施展5次"改变天气"（15÷3=5）
- 最多施展1次"驱逐巨人"（15÷8=1，剩7点）

**对比旧规则：**
- 旧：天降食物最多3次（受次数限制）
- 新：天降食物最多3次（受精力限制）
- **结论**：核心平衡未改变！

## ⚠️ 注意事项

### 对玩家的影响
1. **更灵活**：可以根据需要重复施展同一魔法
2. **更简单**：不用记忆每个魔法的次数限制
3. **更策略**：需要更谨慎地规划精力使用

### 常见问题

**Q: 我可以一天施展10次"改变天气"吗？**
A: 不可以，虽然没有次数限制，但受精力限制。改变天气消耗3点，15点精力最多施展5次。

**Q: 精力什么时候恢复？**
A: 每天凌晨12点自动恢复到满值（15点）

**Q: 为什么移除次数限制？**
A: 
1. 简化游戏机制
2. 增加策略灵活性
3. 精力限制已经足够平衡

**Q: 旧的次数数据会丢失吗？**
A: 不会丢失，数据保留但不再生效。只有精力消耗生效。

## 📝 更新日志

### v1.1.0 (2024-10-19)
- ✅ 移除魔法次数限制
- ✅ 仅保留精力限制
- ✅ 简化用户界面
- ✅ 更新游戏文档

---

**更新时间**：2024-10-19  
**版本**：v1.1.0  
**状态**：✅ 已完成，可立即使用

