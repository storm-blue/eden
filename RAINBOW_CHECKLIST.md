# 🌈 彩虹命令验证清单

使用此清单快速验证彩虹命令功能是否正常工作。

## 🔍 验证步骤

### 1. 后端服务启动
- [ ] 后端服务正常启动（`http://localhost:8080`）
- [ ] 控制台日志显示数据库初始化成功
- [ ] 控制台日志显示 "命令数据初始化成功"

### 2. 数据库检查
```bash
# 检查命令是否已创建
sqlite3 eden-server/lottery.db "SELECT * FROM decree WHERE code='CREATE_RAINBOW';"
```
- [ ] 能看到 `CREATE_RAINBOW` 命令记录
- [ ] 命令名称为 "创造彩虹"
- [ ] `active` 字段初始值为 0（未激活）

### 3. API测试
```bash
# 测试获取命令列表
curl -s "http://localhost:8080/api/decree/list?userId=秦小淮" | jq '.decrees[] | select(.code == "CREATE_RAINBOW")'

# 测试颁布命令
curl -s -X POST "http://localhost:8080/api/decree/issue" \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "code=CREATE_RAINBOW&userId=秦小淮" | jq '.'
```
- [ ] 能成功获取命令列表
- [ ] 看到 "创造彩虹" 命令
- [ ] 颁布命令返回 `success: true`
- [ ] 后端日志显示 "执行命令效果：创造彩虹"

### 4. 前端界面测试

#### 4.1 命令管理弹窗
- [ ] 以"秦小淮"身份登录
- [ ] 进入星星城
- [ ] 左上角显示"📜 颁布命令"按钮
- [ ] 点击按钮打开命令管理弹窗
- [ ] 弹窗中显示"创造彩虹"命令
- [ ] 点击命令名称可以展开/收起描述

#### 4.2 颁布彩虹命令
- [ ] 点击"颁布命令"按钮
- [ ] 显示"命令已颁布！"提示
- [ ] 命令状态变为"已激活"
- [ ] 按钮变为"取消命令"

#### 4.3 彩虹视觉效果
- [ ] 星星城上空出现彩虹
- [ ] 彩虹为七色（红橙黄绿蓝靛紫）
- [ ] 彩虹呈弧形，横跨城市
- [ ] 彩虹有渐入动画（约2秒）
- [ ] 彩虹显示在天气效果之上
- [ ] 彩虹不遮挡建筑点击
- [ ] 彩虹不遮挡UI按钮

#### 4.4 移动端测试
- [ ] 移动端（宽度≤768px）正常显示
- [ ] 强制横屏模式下彩虹正确显示
- [ ] 彩虹边框宽度适配（8px）

#### 4.5 跨用户可见性
- [ ] 退出当前用户
- [ ] 以其他用户身份登录
- [ ] 进入星星城
- [ ] 能够看到彩虹效果
- [ ] 非秦小淮用户看不到"颁布命令"按钮

#### 4.6 取消命令
- [ ] 切换回"秦小淮"账户
- [ ] 打开命令管理弹窗
- [ ] 点击"取消命令"按钮
- [ ] 显示"命令已取消！"提示
- [ ] 命令状态变为"未激活"
- [ ] 彩虹立即消失

### 5. 与其他功能的兼容性

#### 5.1 天气系统兼容
- [ ] 晴天：彩虹正常显示，不遮挡太阳
- [ ] 雨天：彩虹正常显示，与雨滴叠加
- [ ] 雪天：彩虹正常显示，与雪花叠加
- [ ] 多云：彩虹正常显示，与云朵叠加
- [ ] 夜晚：彩虹正常显示，与月亮和星星叠加

#### 5.2 其他命令兼容
- [ ] 同时激活"不得靠近城堡"命令
- [ ] 两个命令都正常工作
- [ ] 彩虹持续显示
- [ ] 城堡禁入规则正常执行

#### 5.3 建筑交互
- [ ] 可以正常点击建筑白圈
- [ ] 居住选择弹窗正常打开
- [ ] 可以正常选择居住

### 6. 性能测试
- [ ] 彩虹动画流畅，无卡顿
- [ ] CPU使用率正常（<50%）
- [ ] 内存占用正常
- [ ] 移动端性能良好

### 7. 浏览器兼容性
- [ ] Chrome/Edge（最新版）
- [ ] Firefox（最新版）
- [ ] Safari（最新版）
- [ ] 移动端浏览器（Chrome/Safari）

### 8. 测试脚本
```bash
# 运行自动化测试脚本
./test-rainbow-decree.sh
```
- [ ] 脚本成功执行
- [ ] 所有API调用返回成功
- [ ] 命令状态正确切换

## ✅ 验证完成

如果所有项目都通过，彩虹命令功能已成功实现并正常工作！

## 🐛 问题排查

### 彩虹不显示
1. 检查浏览器控制台是否有JavaScript错误
2. 确认命令是否真的被激活（`active: true`）
3. 检查 `isRainbowActive` 状态是否正确
4. 确认 `fetchAllDecrees()` 是否被调用

### 颁布命令失败
1. 检查后端服务是否运行
2. 确认用户是否为"秦小淮"
3. 查看后端日志错误信息
4. 检查数据库连接

### 彩虹样式异常
1. 清除浏览器缓存
2. 检查CSS文件是否正确加载
3. 确认 `rainbowAppear` 动画是否定义
4. 检查CSS层级（zIndex）

### 移动端显示问题
1. 确认设备宽度检测正确
2. 检查强制横屏样式是否生效
3. 确认边框宽度是否正确（8px）

## 📞 需要帮助？

参考以下文档：
- [彩虹命令技术文档](./RAINBOW_DECREE.md)
- [实现总结](./RAINBOW_IMPLEMENTATION_SUMMARY.md)
- [命令系统文档](./DECREE_SYSTEM.md)

